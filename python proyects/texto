import json
import os


def getJson(fileName):
    try:
        with open(fileName, 'r') as file:
            jsonData = json.load(file)
        return jsonData
    except:
        print("El json no es v치lido")


def printJson(jsonData):
    for index, object in enumerate(jsonData):
        print(f"{index}. {object}")


def existMail(mail, fileName):
    jsonData = getJson(fileName)
    jumpFirst =False
    if(len(jsonData))==1:
        return True
    else:
        for i in jsonData:
            if jumpFirst:
                if i["mail: "]==mail:
                 print("Este mail ya existe")
                 return False
            else:
                jumpFirst= True
    return True
def filelExists(fileName):
    return os.path.isfile(fileName)


def UserRegister(fileName):
    if not filelExists(fileName):
        with open(fileName, 'w') as fileName:
            UserRegister(fileName)
        
    try:
        # obtener los datos del json
        jsonData = getJson(fileName)
        printJson(jsonData)
        condition = True
        while condition:
            if (len(jsonData) > 0):
                name = input("Enter name: ")
                if (name == ""):
                    condition = False
                    break
                password = input("Enter password: ")
                mail = input("Enter mail: ")

                # verifica mail
                mailBanner = existMail(mail, fileName)
                if mailBanner:
                    user = {"Username: ": name,
                            "Password: ": password, "mail: ": mail}
                    jsonData.append(user)
                    with open(fileName, "w") as file:
                        json.dump(jsonData, file)
                elif not mailBanner:
                    print("Vuelve a intentarlo")
            elif (len(jsonData == 0)):
                name = input("Enter name: ")
                if (name == ""):
                    condition = False
                    break
                password = input("Enter password: ")
                mail = input("Enter mail: ")
                user = {"Username: ": name,
                        "Password: ": password, "mail: ": mail}
                jsonData.append(user)
                with open(fileName, "w") as file:
                    json.dump(jsonData, file)

        printJson(jsonData)
    except:
        print("Algo ha ido mal")


def loginUser(name, password, fileName):
    loginStatus = False
    jsonData = getJson(fileName)
    for i in jsonData:
        if (i["Username: "] == name) and (i["Password: "] == password):
            loginStatus = True
            print("Bienvenido")
            break
    if not loginStatus:
        print("No se encontraron registros")

    # return loginStatus


def ReadFile(fileName):
    with open(fileName, 'r') as file:
        users = json.load(file)

        for i, user in enumerate(users):
            print(f"{i}. {user}")


def undefinedFunction():
    print("Undefined function")


def deleteUser(name, fileName):
    jsonData = getJson(fileName)
    foundStatus = False
    for i in jsonData:
        if i["Username: "] == name:
            jsonData.remove(i)
            found = True
            break
    if found:
        with open(fileName, "w") as file:
            json.dump(jsonData, file)
        print(f"El usuario '{name}' ha sido eliminado")
    else:
        print(f"No se encontr칩 el usuario '{name}' en el archivo")


def modifyUserField(fileName, name, field):
    try:
        jsonData = getJson(fileName)
        for i in jsonData:
            if i["Username: "] == name:
                i[field] = input(f"Enter new {field}: ")
                with open(fileName, "w") as file:
                    json.dump(jsonData, file)
                print(f"{field} updated for {name}")
                return True
        print(f"User '{name}' not found")
        return False
    except:
        print("An error occurred")
        return False


print("------------Opciones-------------")
print("1) Registrar Usuario ", "2) Iniciar sesi칩n ", "3) Salir ")
fileName = "prueba1.txt"
condition = True

while condition:
    x = int(input("Ingresa lo que desees hacer (1,2,3)"))

    if x == 1:
        UserRegister(fileName)
    elif x == 2:
        name = input("Ingresa el nombre de usuario: ")
        password = input("Ingresa la contrase침a: ")

        loginUser(name, password, fileName)
    elif x == 3:
        condition = False
        (lambda: (print("Adios"), exit()))
    else:
        undefinedFunction()
